
# Our AWS setup 
This README will give you a general idea of how our project is setup within AWS.

## Important Links For Getting Started With Copilot 
Here is a link to [copilot installation](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Copilot.html) instructions.

Link to documentation on the [copilot tool and basic AWS concepts](https://aws.github.io/copilot-cli/docs/overview/)

## Important Copilot Commands
copilot has really good explanations how to use their commands 

Run: *copilot* to get a quick explanation of where to start.

The following commands I found to be super helpful when getting a nice description of whats going in each section of the AWS project
- *copilot app show*
- *copilot svc show*
- *copilot env show*
- *copilot pipeline show*


## AWS Directory File Overivew
Within this directory we have 
1. **copilot dir** which is an auto-generated directory for aws copilot which is a tool which will be needed for more direct AWS infrastructure work. 
1. **local_deploy.py** a deploy script which will send your docker images to ECR. **NOTE**: This is not the preffered method of uploading the containers and should only be used if you need to force changes up. 
1. **aws_credentials.csv** a file which should contain your personal aws login information.

## IAM Roles
*Identity and Access Manegment*
[Link](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html) to IAM user guide. 

Right now we have two permission groups set up which cover everything we need for our current workflows.
1. Biopath_admin_user
1. Biopath_AWS_dev_group

**Biopath_admin_user:** allows the user to have administrator access and the ability to edit accounts. 

**Biopath_AWS_dev_group:** all the permissions necessary for operating aws copilot. 

**NOTE:**
These roles are not final and will likley need to change should additional resources become necesary.


## Infrastructure Overview
**Please read the tool and concepts documentation linked above to understand the basics before proceeding.**

### Application
Within AWS, our app is called biopath. This app is a collection of services. In our case our two services will include a frontend

### Enviornment
Enviornments in copilot are areas where builds (services) can be running. For now we only have production as we don't necessarily need a test enviornment seeing as we don't yet have any users. This can be a consideration for future development once such a thing becomes necessary.

### Services
As mentioned in the Enviornment section, we will have a frontend and backend service. Both of these will be induvidually linked to their respective dockerfiles within frontend/ and backend/


# Setup To Get Started
**Important**: When creating AWS accounts, keep track of your:
1. User Name
1. Account ID
1. Access Key ID
1. Secret Access Key
1. Password
You should store this information in an *aws_credentials.csv* file within this directory.

**You need to use you own sign in info when using github copilot**
AWS has a strict policy which doesn't allow the root user to push its own infrastructure. You have to do it through a team managed role which the team needs to set up. I would recommend using the root sign in when using the online AWS console so you can ensure you have the ability to make edits. You should use your own account for everything else.

## How to Create a User with the Correct Permissions
In order to create accounts for your team, you will want to:
1. Sign into the AWS console as the Biopath root user information. 
1. Navigate over to the IAM page going through the search bar.
1. Once you've made it to the IAM dashboard, you will have a navigation side bar on the left side. You will need to click on Users.
1. Click on **create user** and make sure to check the *Provide user access to the AWS Management Console Option*, Specify that you want to make an IAM user. You will want the password to be autogenerated and require that the user make their own password on next sign in. 
1. When **setting permissions** choose add user to group. You should select both *Biopath_admin_user* and *Biopath_AWS_dev_group*. The motivation for each of these groups is explained above under **IAM Roles**
1. After you **Create User**, email out the instructions to sign up. You will need to send the password created in a separate email as well.

## Navigating the AWS Console

In the Search bar important pages you will visit frequently will be 
1. ECS
2. ECR
3. IAM 
4. Cloudformation 


### Brief Description Of Each
1. ECS contains all of our clusters, services, and task definitions that we have created. Go here to see what is currently running.
2. ECR is the repository for our dockerfiles, any containers we push up should appear here 
3. IAM, as mentioned above, this is where you manage your teams access to AWS resources.
4. Cloudformation, because we are using copilot, by default our infrastructure schema is uploaded by default. **Here you can view the our infrastructure porgress and any errors that may occur**

# Design Choices
## 2022-2023 Group 
Given the amount of time we had to meet our sponsers requirements as well as get the infrastructure deployed we had to go with something simple. This is the main reason we went with running both the Frontend and Backend on separate app runner contexts. This approach performs a lot of background magic though which may be problematic if you need to change how something is configured.

There likley is a much better way to set this up. Something future teams can look into is [Deploying through Docker-compose](https://aws.amazon.com/blogs/containers/deploy-applications-on-amazon-ecs-using-docker-compose/). This makes a bit more sense to the larger application given that we have already defined how it interacts with itself within the docker-compose file.

Given that future groups will likely also be coming into this project with very little AWS expirience Make sure to document any changes you make in this file. 